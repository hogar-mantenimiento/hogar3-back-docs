"use strict";(globalThis.webpackChunkhogar_3_back_docs=globalThis.webpackChunkhogar_3_back_docs||[]).push([[9548],{3010:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"Components/decoradores","title":"Decoradores","description":"Hay decoradores generales usables en todo el proyecto.","source":"@site/docs/Components/decoradores.md","sourceDirName":"Components","slug":"/Components/decoradores","permalink":"/hogar3-back-docs/docs/Components/decoradores","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Components/decoradores.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Components","permalink":"/hogar3-back-docs/docs/category/components"},"next":{"title":"Clases Internas","permalink":"/hogar3-back-docs/docs/Components/Clases"}}');var o=r(4848),a=r(8453);const d={sidebar_position:1},i="Decoradores",l={},t=[{value:"<code>@CatchError</code>",id:"catcherror",level:3},{value:"Uso",id:"uso",level:4},{value:"Limitaciones",id:"limitaciones",level:4},{value:"<code>@CatchErrorListener</code>",id:"catcherrorlistener",level:3},{value:"<code>@SaveImage(path: string, options...)</code>",id:"saveimagepath-string-options",level:3},{value:"1. Uso B\xe1sico (Una sola imagen)",id:"1-uso-b\xe1sico-una-sola-imagen",level:4},{value:"2. Uso con M\xfaltiples Im\xe1genes (Plural)",id:"2-uso-con-m\xfaltiples-im\xe1genes-plural",level:4},{value:"3. Opciones Avanzadas (Combinando con DTOs y Swagger)",id:"3-opciones-avanzadas-combinando-con-dtos-y-swagger",level:4},{value:"<code>@Auth()</code> y <code>@GetUser()</code>",id:"auth-y-getuser",level:3},{value:"<code>@Auth()</code>",id:"auth",level:4},{value:"<code>@GetUser()</code>",id:"getuser",level:4},{value:"Ejemplo de Uso Combinado",id:"ejemplo-de-uso-combinado",level:4}];function c(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"decoradores",children:"Decoradores"})}),"\n",(0,o.jsx)(n.p,{children:"Hay decoradores generales usables en todo el proyecto."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"catcherror",children:(0,o.jsx)(n.code,{children:"@CatchError"})}),"\n",(0,o.jsxs)(n.p,{children:["Se utiliza en los ",(0,o.jsx)(n.strong,{children:"Services"})," del proyecto, envolviendo los m\xe9todos de la clase."]}),"\n",(0,o.jsxs)(n.p,{children:["Este decorador permite encapsular el m\xe9todo decorado dentro de un bloque ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"try...catch"})})," ya conectado con la funci\xf3n de manejo de errores (",(0,o.jsx)(n.code,{children:"handleError"}),") de la capa ",(0,o.jsx)(n.code,{children:"common"}),". Esto evita la repetici\xf3n manual del manejo de errores en cada m\xe9todo del servicio."]}),"\n",(0,o.jsx)(n.h4,{id:"uso",children:"Uso"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{style:{textAlign:"left"},children:"Sin el decorador"}),(0,o.jsx)(n.th,{style:{textAlign:"left"},children:"Con el decorador"})]})}),(0,o.jsx)(n.tbody,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsxs)(n.td,{style:{textAlign:"left"},children:["Se debe implementar un bloque ",(0,o.jsx)(n.code,{children:"try...catch"})," en cada m\xe9todo que lo requiera."]}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"El decorador se encarga de manejar el error autom\xe1ticamente."})]})})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo sin el decorador"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export class XService {\n  \n  constructor(\n    private readonly common: CommonService,\n  ){}\n\n  async methodFunction(){\n    try {\n      // L\xf3gica de la funci\xf3n\n      // ...\n    } catch (error) {\n      this.common.handleError(error) // Manejo manual del error\n    }\n  }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo con el decorador"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export class XService {\n\n  @CatchError\n  async methodFunction(){\n    // L\xf3gica de la funci\xf3n (el manejo de errores es impl\xedcito)\n    // ...\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"limitaciones",children:"Limitaciones"}),"\n",(0,o.jsxs)(n.p,{children:["Este decorador ",(0,o.jsx)(n.strong,{children:"no funciona o no debe usarse"})," en los siguientes casos:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Listeners:"})," Cuando el m\xe9todo es un ",(0,o.jsx)(n.em,{children:"listener"})," (ej. ",(0,o.jsx)(n.em,{children:"event handlers"})," o ",(0,o.jsx)(n.em,{children:"message consumers"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Manejo de Response:"})," Cuando se requiere el objeto ",(0,o.jsx)(n.code,{children:"Response"})," de ",(0,o.jsx)(n.strong,{children:"ExpressJS"})," para manipular directamente la respuesta HTTP."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Para casos donde se necesita el ",(0,o.jsx)(n.code,{children:"Response"}),", existe una funci\xf3n en el ",(0,o.jsx)(n.em,{children:"common"})," para ello."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"catcherrorlistener",children:(0,o.jsx)(n.code,{children:"@CatchErrorListener"})}),"\n",(0,o.jsxs)(n.p,{children:["Este decorador funciona igual que ",(0,o.jsx)(n.code,{children:"@CatchError"}),", pero est\xe1 ",(0,o.jsxs)(n.strong,{children:["dise\xf1ado espec\xedficamente para los ",(0,o.jsx)(n.em,{children:"listeners"})]}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Es menos com\xfan su uso en el proyecto, pero est\xe1 disponible si se requiere manejar errores en m\xe9todos que act\xfaan como ",(0,o.jsx)(n.em,{children:"listeners"})," de eventos o mensajes."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"saveimagepath-string-options",children:(0,o.jsx)(n.code,{children:"@SaveImage(path: string, options...)"})}),"\n",(0,o.jsxs)(n.p,{children:["El decorador ",(0,o.jsx)(n.code,{children:"@SaveImage"})," es una utilidad personalizada dise\xf1ada para simplificar la configuraci\xf3n de subida de archivos e im\xe1genes en ",(0,o.jsx)(n.em,{children:"endpoints"})," de NestJS. Combina m\xfaltiples interceptores y decoradores de Swagger, gestionando la l\xf3gica de ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"multer"})})," para el guardado en disco y el manejo de im\xe1genes."]}),"\n",(0,o.jsx)(n.h4,{id:"1-uso-b\xe1sico-una-sola-imagen",children:"1. Uso B\xe1sico (Una sola imagen)"}),"\n",(0,o.jsxs)(n.p,{children:["Para guardar una sola imagen, aplica ",(0,o.jsx)(n.code,{children:"@SaveImage"})," a tu m\xe9todo de controlador, especificando la ruta dentro de la carpeta ",(0,o.jsx)(n.code,{children:"static"})," donde se guardar\xe1 el archivo."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Sintaxis:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@SaveImage(path: string)\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",metastring:'title="users.controller.ts"',children:"@Post('avatar')\n@SaveImage('users/avatars') // La imagen se guarda en `./static/users/avatars`\nasync uploadAvatar(\n  @UploadedFile() file: Express.Multer.File\n) {\n  // `file` contendr\xe1 la informaci\xf3n del archivo guardado\n  return { filename: file.filename, path: file.path };\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Nota Importante:"})," El ",(0,o.jsx)(n.em,{children:"endpoint"})," espera que el archivo se env\xede en el campo ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"file"})})," del formulario ",(0,o.jsx)(n.em,{children:"multipart"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h4,{id:"2-uso-con-m\xfaltiples-im\xe1genes-plural",children:"2. Uso con M\xfaltiples Im\xe1genes (Plural)"}),"\n",(0,o.jsxs)(n.p,{children:["Para permitir la subida de varios archivos a la vez, se debe usar la opci\xf3n ",(0,o.jsx)(n.code,{children:"plural: true"}),". Opcionalmente, puedes limitar la cantidad con ",(0,o.jsx)(n.code,{children:"pluralCount"}),"."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Sintaxis:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@SaveImage(path: string, { plural: true, pluralCount?: number })\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",metastring:'title="products.controller.ts"',children:"@Post(':id/images')\n@SaveImage('products/gallery', { plural: true, pluralCount: 5 }) // Permite hasta 5 im\xe1genes\nasync uploadImages(\n  @UploadedFiles() files: Array<Express.Multer.File>\n) {\n  // `files` es un array con la informaci\xf3n de los archivos guardados\n  return files.map(f => f.filename);\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Nota Importante:"})," Cuando ",(0,o.jsx)(n.code,{children:"plural: true"}),", el ",(0,o.jsx)(n.em,{children:"endpoint"})," espera que los archivos se env\xeden en el campo ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"files"})})," del formulario ",(0,o.jsx)(n.em,{children:"multipart"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h4,{id:"3-opciones-avanzadas-combinando-con-dtos-y-swagger",children:"3. Opciones Avanzadas (Combinando con DTOs y Swagger)"}),"\n",(0,o.jsxs)(n.p,{children:["El decorador permite integrar un ",(0,o.jsx)(n.strong,{children:"Data Transfer Object (DTO)"})," para incluir datos adicionales del cuerpo de la solicitud (como descripciones) junto con el archivo en Swagger (",(0,o.jsx)(n.code,{children:"ApiBody"}),")."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Sintaxis Completa:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@SaveImage<T>(path: string, options?: {\n  filter?: filterType;      // Funci\xf3n personalizada para filtrar archivos.\n  doc?: Type<T>;            // DTO para incluir en el body de Swagger.\n  plural?: boolean;\n  pluralCount?: number;\n})\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo con DTO:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",metastring:'title="products.controller.ts"',children:"// DTO para datos adicionales\nexport class CreateProductImageDto {\n  @ApiProperty()\n  description: string;\n}\n\n@Post(':id/image-with-data')\n@SaveImage<CreateProductImageDto>('products/single', { doc: CreateProductImageDto })\nasync uploadImageWithData(\n  @Body() createDto: CreateProductImageDto,\n  @UploadedFile() file: Express.Multer.File\n) {\n  // El DTO (createDto) es autom\xe1ticamente parseado\n  return { ...createDto, filename: file.filename };\n}\n"})}),"\n",(0,o.jsxs)(n.h3,{id:"auth-y-getuser",children:[(0,o.jsx)(n.code,{children:"@Auth()"})," y ",(0,o.jsx)(n.code,{children:"@GetUser()"})]}),"\n",(0,o.jsxs)(n.p,{children:["Ambos decoradores se correlacionan, siendo ",(0,o.jsx)(n.code,{children:"@GetUser()"})," dependiente de que el ",(0,o.jsx)(n.em,{children:"endpoint"})," est\xe9 protegido por ",(0,o.jsx)(n.code,{children:"@Auth()"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"auth",children:(0,o.jsx)(n.code,{children:"@Auth()"})}),"\n",(0,o.jsxs)(n.p,{children:["Este decorador se usa directamente en el ",(0,o.jsx)(n.strong,{children:"controller"})," (a nivel de clase o de m\xe9todo), protegiendo los ",(0,o.jsx)(n.em,{children:"endpoints"})," en base a la validaci\xf3n de un token y ",(0,o.jsx)(n.strong,{children:"permisos"})," asociados."]}),"\n",(0,o.jsxs)(n.p,{children:["El @Auth ademas internamente verifica si el usuario tiene ese modulo en activo, bloqueandolo si no lo tiene activado como parte de su ",(0,o.jsx)(n.strong,{children:"SuperCliente o Profiler"})]}),"\n",(0,o.jsx)(n.h4,{id:"getuser",children:(0,o.jsx)(n.code,{children:"@GetUser()"})}),"\n",(0,o.jsxs)(n.p,{children:["Este es un decorador de par\xe1metros que solo funciona en ",(0,o.jsx)(n.em,{children:"endpoints"})," protegidos con ",(0,o.jsx)(n.code,{children:"@Auth()"}),". Permite inyectar el objeto ",(0,o.jsx)(n.code,{children:"user"})," (extra\xeddo del token validado por ",(0,o.jsx)(n.code,{children:"@Auth()"}),") directamente en el m\xe9todo del controlador."]}),"\n",(0,o.jsx)(n.h4,{id:"ejemplo-de-uso-combinado",children:"Ejemplo de Uso Combinado"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",metastring:'title="auth.controller.ts"',children:"@Get('me')\n@Auth() // 1. Protege el endpoint y valida el token/permisos\ngetme(@GetUser() user: User){ // 2. Captura el objeto User ya validado\n  return this.Service.MethodFunction(user)\n}\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"esos serian todos los decoradores importantes, si me acuerdo de alguno mas, lo agregare"})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>i});var s=r(6540);const o={},a=s.createContext(o);function d(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);